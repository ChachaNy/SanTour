<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
	<meta name="viewport" content="initial-scale=1">
    <title>SanTour</title>



    <link rel="stylesheet" href="css/materialize.css">
	<link rel="stylesheet" href="css/custom.css">
	<link rel="stylesheet" href="cssFiles/nouislider.min.css">
	
	<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
	<script src="https://code.highcharts.com/highcharts.js"></script>
	<script src="https://code.highcharts.com/highcharts-more.js"></script>
	<script src="https://code.highcharts.com/modules/exporting.js"></script>
	<script src="scripts/nouislider.min.js"></script>
	<script src="js/wNumb.js"></script>
	<script src="js/materialize.js"></script>
    <script src="http://underscorejs.org/underscore-min.js"></script>
	

</head>

<body>


	
	  <div class="row">
		
		  <div class="col l6 m6 s12">
			<div class="section" id="banner">
				<div>
					<img class="responsive-img" src="img/banner-816.jpg">
				</div>
			</div>
			
			<div class="formContent">
				<!-- SANTE -->
				<div class="section" id="sante">
					<div class="inner split" style="margin-top:30px;">
						<div>
							<h3>Profil santé</h3>
						</div>
						<div class="divider"></div>
					</div>
				</div>

				<!-- One -->
				<div class="section" id="a1" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Activité Physique</h5>
							<div id="sec_ap1">
								<p>Est-ce que vous avez une activité physique régulière?</p>
								<input name="ap1" id="ap1_1" value="1" type="radio">
								<label for="ap1_1">oui</label>
								<input name="ap1" id="ap1_2" value="0" type="radio">
								<label for="ap1_2">non</label>
							</div>
							<div id="sec_ap2" style="display: none;">
								<p>Diriez vous que vous êtes actif-ve au moins 30 minutes chaque jour (au moins 5 jours par
									semaine)?</p>
								<input name="ap2" id="ap2_1" value="1" type="radio">
								<label for="ap2_1">oui</label>
								<input name="ap2" id="ap2_2" value="0" type="radio">
								<label for="ap2_2">non</label>
							</div>
							<div id="sec_ap3" style="display: none;">
								<p>Est-ce qu'il vous arrive parfois/regulièrement de transpirer ou d'être essoufflé/e durant cette
									activité?</p>
								<input name="ap3" id="ap3_1" value="1" type="radio">
								<label for="ap3_1">oui</label>
								<input name="ap3" id="ap3_2" value="0" type="radio">
								<label for="ap3_2">non</label>
							</div>
							<div id="sec_ap4" style="display: none;">
								<p>Est-ce que vous auriez envie de reprendre une activité physique plus importante dans les
									prochains mois?</p>
								<input name="ap4" id="ap4_1" value="1" type="radio">
								<label for="ap4_1">oui</label>
								<input name="ap4" id="ap4_2" value="0" type="radio">
								<label for="ap4_2">non</label>
							</div>
							<div id="sec_ap5" style="display: none;">
								<p>Est-ce que vous connaisez les avantages que l'activité physique peut apporter pour la
									santé?</p>
								<input name="ap5_1" id="ap5_1_1" value="1" type="radio">
								<label for="ap5_1_1">oui</label>
								<input name="ap5_1" id="ap5_1_2" value="0" type="radio">
								<label for="ap5_1_2">non</label>

								<p>Est-ce que vous connaisez les risques de l'inactivité?</p>
								<input name="ap5_2" id="ap5_2_1" value="1" type="radio">
								<label for="ap5_2_1">oui</label>
								<input name="ap5_2" id="ap5_2_2" value="0" type="radio">
								<label for="ap5_2_2">non</label>
							</div>
						</div>
					</div>
				</div>

				<!-- MARCHER SANS AIDE-->
				<div class="section" id="s1" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Marcher sans aides</h5>
							<p>Quels dispositifs d'aide à la marche utilisez vous?</p>
							<input name="q1" id="r1_1" value="5" type="radio">
							<label for="r1_1">aucune</label>
							<input name="q1" id="r1_2" value="4" type="radio">
							<label for="r1_2">une canne</label>
							<input name="q1" id="r1_3" value="3" type="radio">
							<label for="r1_3">deux cannes</label>
							<input name="q1" id="r1_4" value="2" type="radio">
							<label for="r1_4">déambulateur</label>
							<input name="q1" id="r1_5" value="1" type="radio">
							<label for="r1_5">cadre de marche</label>
							<input name="q1" id="r1_6" value="0" type="radio">
							<label for="r1_6">j'ai besoin de l'aide d'une tierce personne</label>
						</div>
					</div>
				</div>

				<!-- VITESSE DE MARCHE-->
				<div class="section" id="s2" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Vitesse Marche</h5>
							<p>Par rapport à la vitesse de marche moyenne (celle de vos proches), pensez vous marcher
								habituellement ... </p>
							<input name="q2" id="r2_1" value="1" type="radio">
							<label for="r2_1">nettement moins vite</label>
							<input name="q2" id="r2_2" value="2" type="radio">
							<label for="r2_2">un peu moins vite</label>
							<input name="q2" id="r2_3" value="3" type="radio">
							<label for="r2_3">à la même vitesse</label>
							<input name="q2" id="r2_4" value="4" type="radio">
							<label for="r2_4">un peu plus vite</label>
							<input name="q2" id="r2_5" value="5" type="radio">
							<label for="r2_5">nettement plus vite</label>
						</div>
					</div>
				</div>


				<!-- TEMPS DE MARCHE-->
				<div class="section" id="s3" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Temps de Marche</h5>
							<p>Entourez le temps maximale que vous pensez pouvoir tenir sans vous arrêter pour vous reposer</p>
							<input name="q3" id="r3_1" value="0" type="radio">
							<label for="r3_1">impossible</label>
							<input name="q3" id="r3_2" value="1" type="radio">
							<label for="r3_2">1 minute</label>
							<input name="q3" id="r3_3" value="2" type="radio">
							<label for="r3_3">5 minutes</label>
							<input name="q3" id="r3_4" value="3" type="radio">
							<label for="r3_4">15 minutes</label>
							<input name="q3" id="r3_5" value="4" type="radio">
							<label for="r3_5">30 minutes</label>
							<input name="q3" id="r3_6" value="5" type="radio">
							<label for="r3_6">1 heure</label>
							<input name="q3" id="r3_7" value="6" type="radio">
							<label for="r3_7">2 heures</label>
							<input name="q3" id="r3_8" value="7" type="radio">
							<label for="r3_8">3 heures et plus</label>
							<ul class="actions">

							</ul>
						</div>
					</div>
				</div>

				<!-- CAPACITE A MONTER-->
				<div class="section" id="s4" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Capacité à monter</h5>
							<h7>Reportez le degré de difficulté physique qui décrit le mieux la
								difficulté que vous avez eue à monter des escaliers, sans vous arrêter
								pour vous reposer, au cours de la dernière semaine
							</h7>
							<p>Monter 1 étage</p>
							<input name="q4_1" id="r4_1_1" value="4" type="radio">
							<label for="r4_1_1">aucun</label>
							<input name="q4_1" id="r4_1_2" value="3" type="radio">
							<label for="r4_1_2">léger</label>
							<input name="q4_1" id="r4_1_3" value="2" type="radio">
							<label for="r4_1_3">moyen</label>
							<input name="q4_1" id="r4_1_4" value="1" type="radio">
							<label for="r4_1_4">important</label>
							<input name="q4_1" id="r4_1_5" value="0" type="radio">
							<label for="r4_1_5">infaisable</label>

							<div id="etage3">
								<p>Monter 3 étages</p>
								<input name="q4_2" id="r4_2_1" value="9" type="radio">
								<label for="r4_2_1">aucun</label>
								<input name="q4_2" id="r4_2_2" value="8" type="radio">
								<label for="r4_2_2">léger</label>
								<input name="q4_2" id="r4_2_3" value="7" type="radio">
								<label for="r4_2_3">moyen</label>
								<input name="q4_2" id="r4_2_4" value="6" type="radio">
								<label for="r4_2_4">important</label>
								<input name="q4_2" id="r4_2_5" value="5" type="radio">
								<label for="r4_2_5">infaisable</label>
							</div>

							<div id="etage5">
								<p>Monter 5 étages</p>
								<input name="q4_3" id="r4_3_1" value="14" type="radio">
								<label for="r4_3_1">aucun</label>
								<input name="q4_3" id="r4_3_2" value="13" type="radio">
								<label for="r4_3_2">léger</label>
								<input name="q4_3" id="r4_3_3" value="12" type="radio">
								<label for="r4_3_3">moyen</label>
								<input name="q4_3" id="r4_3_4" value="11" type="radio">
								<label for="r4_3_4">important</label>
								<input name="q4_3" id="r4_3_5" value="10" type="radio">
								<label for="r4_3_5">infaisable</label>
							</div>
						</div>
					</div>
				</div>


				<!-- ASSURANCE A MARCHER-->
				<div class="section" id="s8" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Assurance à marcher</h5>
							<p>Est-ce que vous avez peur de chuter?</p>
							<input name="q8_1" id="r8_1_1" value="0" type="radio">
							<label for="r8_1_1">oui</label>
							<input name="q8_1" id="r8_1_2" value="1" type="radio">
							<label for="r8_1_2">non</label>

							<p>Avez vous chuté lors des 12 derniers mois?</p>
							<input name="q8_2" id="r8_2_1" value="3" type="radio">
							<label for="r8_2_1">non</label>
							<input name="q8_2" id="r8_2_2" value="2" type="radio">
							<label for="r8_2_2">une fois</label>
							<input name="q8_2" id="r8_2_3" value="1" type="radio">
							<label for="r8_2_3">deux fois</label>
							<input name="q8_2" id="r8_2_4" value="0" type="radio">
							<label for="r8_2_4">plusieurs fois</label>

							<p>Avez vous parfois des vertiges?</p>
							<input name="q8_3" id="r8_3_1" value="0" type="radio">
							<label for="r8_3_1">oui</label>
							<input name="q8_3" id="r8_3_2" value="1" type="radio">
							<label for="r8_3_2">non</label>
						</div>
					</div>
				</div>

				<!-- PEUR DU VIDE-->
				<div class="section" id="s5" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Peur du vide</h5>
							<p>Avez vous peur de l'altitude (peur du vide)?</p>
							<input name="q5" id="r5_1" value="1" type="radio">
							<label for="r5_1">oui</label>
							<input name="q5" id="r5_2" value="0" type="radio">
							<label for="r5_2">non</label>
						</div>
					</div>
				</div>

				<!-- EQUILIBRE-->
				<div class="section" id="s9" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Equilibre</h5>
							<p>Est-ce que vous vous sentez sûr de vous lors que vous vous tenez debout sur une seule jambe sans
								vous tenir à quelque chose?</p>
							<input name="q9" id="r9_2" value="2" type="radio">
							<label for="r9_2">oui, je me sens sûr-e</label><input name="q9" id="r9_1" value="1" type="radio">
							<label for="r9_1">non, je ne me sens pas sûr-e</label>
							<input name="q9" id="r9_3" value="0" type="radio">
							<label for="r9_3">impossible de faire sans me tenir</label>
						</div>
					</div>
				</div>

				<!-- DOULEURS-->
				<div class="section" id="s6" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Douleurs</h5>
							<p>Avez vous des douleurs?</p>
							<input name="q6" id="r6_1" value="1" type="checkbox" onclick="checkPain(this)">
							<label for="r6_1">Douleurs dans la hanche</label>
							<input name="q6" id="r6_2" value="1" type="checkbox" onclick="checkPain(this)">
							<label for="r6_2">Douleurs aux genoux</label>
							<input name="q6" id="r6_3" value="1" type="checkbox" onclick="checkPain(this)">
							<label for="r6_3">Douleurs aux pieds</label>
							<input name="q6" id="r6_4" value="1" type="checkbox" onclick="checkPain(this)">
							<label for="r6_4">Douleurs au dos</label>
							<input name="q6" id="r6_5" value="1" type="checkbox" onclick="checkPain(this)">
							<label for="r6_5">Douleurs ailleurs</label>
							<input name="q6" id="r6_6" value="0" type="checkbox">
							<label for="r6_6">Pas de douleurs</label>
						</div>
					</div>
				</div>

				<!-- MOBILITE-->
				<div class="section" id="s7" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Mobilité articulaire</h5>
							<p>Avez vous des problèmes de mobilité dans une ou plusieurs des articulations suivantes?</p>
							<input name="q7" id="r7_1" value="1" type="checkbox" onclick="checkMobility(this)">
							<label for="r7_1">Mobilité réduite à la cheville</label>
							<input name="q7" id="r7_2" value="1" type="checkbox" onclick="checkMobility(this)">
							<label for="r7_2">Mobilité réduite aux genoux</label>
							<input name="q7" id="r7_3" value="1" type="checkbox" onclick="checkMobility(this)">
							<label for="r7_3">Hanche</label>
							<!--<input name="q7" id="r7_4" value="1" type="checkbox">
							<label for="r7_4">Hanche</label>  A VERIFIER AVEC ROGER-->
							<input name="q7" id="r7_4" value="0" type="checkbox">
							<label for="r7_4">Pas de problèmes de mobilité</label>
						</div>
					</div>
				</div>
				
				
				<!-- PREFERENCES -->
				<div class="section" id="sante">
					<div class="inner split" style="margin-top:30px;">
						<div>
							<div class="section">
								<h3>Préférences</h3>
							</div>
							<div class="divider"></div>
						</div>
					</div>
				</div>

				<!-- OBSTACLES -->
				<div class="section" id="s8" class="wrapper">
					 <div class="inner split">
						<div class="section">
							<h5>Les obstacles</h5>
							<p>Évaluer de -10 (je déteste), 0 (ça m'est égal), à +10 (j'aime).</p>
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r8_1"> Racines: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r8_1" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format0" style="height:22px;">
								</div>								
							</div> <!-- End of row -->
								<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r8_2"> Cailloux: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r8_2" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format1" style="height:22px;">
								</div>								
							</div> <!-- End of row -->
								<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r8_3"> Cabossé: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r8_3" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format2" style="height:22px;">
								</div>								
							</div> <!-- End of row -->
						</div>
					 </div>
				</div>

				<!-- TOPOLOGIE -->
				<div class="section" id="s9" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>La topologie</h5>
							<p>Évaluer de -10 (je déteste), 0 (ça m'est égal), à +10 (j'aime).</p>
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r9_1"> Montées: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r9_1" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format3" style="height:22px;">
								</div>								
							</div> <!-- End of row -->
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r9_2"> Descentes: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r9_2" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format4" style="height:22px;">
								</div>								
							</div> <!-- End of row -->
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r9_3"> Plat: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r9_3" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format5" style="height:22px;">
								</div>								
							</div> <!-- End of row -->												
						</div>
					</div>
				</div>

				<!-- PEUR DU VIDE -->
				<div class="section" id="s10" class="wrapper">
					<div class="inner split">
						<div class="section">
							<h5>Peur du vide</h5>
							<p>Évaluer de -10 (je déteste), 0 (ça m'est égal), à +10 (j'aime).</p>
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r10_1"> Ponts: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r10_1" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format6" style="height:22px;">
								</div>								
							</div> <!-- End of row -->						
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r10_2"> Crètes: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r10_2" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format7" style="height:22px;">
								</div>								
							</div> <!-- End of row -->
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r10_3"> Main courante: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r10_3" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format8" style="height:22px;">
								</div>								
							</div> <!-- End of row -->								
						</div>
					 </div>
				</div>

				<!-- DUREE -->
				<div class="section" id="s11" class="wrapper">
					 <div class="inner split">
						<div class="section">
							<h5>Durée</h5>
							<p>Évaluer de -10 (je déteste), 0 (ça m'est égal), à +10 (j'aime).</p>
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r11_1"> 1h: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r11_1" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format9" style="height:22px;">
								</div>								
							</div> <!-- End of row -->					
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r11_2"> 2h: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r11_2" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format10" style="height:22px;">
								</div>								
							</div> <!-- End of row -->					
							<div class="row">						
								<div class="col xl1 l12 s12">
									<label for="r11_3"> 3h et +: </label>
								</div>
								<div class="col xl4 l8 s8">
									<div id="r11_3" class="sliders" onclick="redraw(false)"></div>
								</div>
								<div class="col xl1 l4 s4">
									<input disabled="disabled" class="rValue" type="text" id="input-format11" style="height:22px;">
								</div>								
							</div> <!-- End of row -->					
						</div>
					 </div>
				</div>				
			</div><!-- Fin div class="formContent" formulaire -->
		</div> <!-- Fin div class="section" formulaire -->

		<div class="col l6 m6 s12" >
			
			<div class="target" style="overflow-y: scroll; height: 100%;"> 
				<div class="row z-depth-3" >
					<div class="col m6 s12">
						<div id="radarID"></div>
					</div>


					<div class="col m6 s12">
						<div id="radarPref"></div>
					</div>


					<div class="col m12 s12">
						<div id="recommendationsID" class="section" >
							<h5>Recommandations</h5>
                            <div style="display: none;">
							<b>Durée de la route à proposer:</b>
							<span id="rec1"></span><br>
							<b>Vitesse de la marche:</b>
							<span id="rec2"></span><br>
							<b> Chemins:</b>
							<span id="rec3"></span><br>
							<b>Denivelé:</b>
							<span id="rec4"></span><br>
							<b>Risques de chute:</b>
							<span id="rec5"></span><br>
							<b>Brochures/infos/conseils:</b>
							<span id="rec6"></span><br>
                            </div>
                            <table id="pathTable" class="highlight">
                             
                              
                            </table>
                            <p id="paths"></p>
						</div>
					</div>
                    
                    <button class="waves-effect waves-light btn" onclick="computeScores()">Recommandation</button>

				</div>
			</div>

		</div>
		
	</div> <!-- Enf of row -->
		
	<!-- FOOTER -->
	 <footer class="page-footer cyan darken-3">
		<div class="footer-copyright">
			© HES-SO Valais-Wallis. All rights reserved.
		</div>
	 </footer>


<script>

	function checkPain(checkbox){
		if(checkbox.checked){
			$('#r6_6').prop('checked', false);
		}
	}
	
	function checkMobility(checkbox){
		if(checkbox.checked){
			$('#r7_4').prop('checked', false);
		}
	}
	
  //Create sliders
	var x = document.getElementsByClassName("sliders");

	for(var i= 0; i < x.length; i++)
	{

		noUiSlider.create(x[i], {
			start: [0],
			connect: true,
			step: 1,
			range: {
			'min': -10,
			'max': 10
			}
		});
		
		
		var sliderFormat = x[i];
		
		var inputFormat = document.getElementById('input-format'+i);

		sliderValue(sliderFormat, inputFormat);


	}
	
	function sliderValue(sliderFormat, inputFormat){
		sliderFormat.noUiSlider.on('update', function( values, handle ) {
			inputFormat.value = values[handle];
		});

		inputFormat.addEventListener('change', function(){
			sliderFormat.noUiSlider.set(this.value);
		});
	
	}
	
	//Pushpin -> fixed right div 
	 $(document).ready(function(){
		$('.target').pushpin({
		  top: 0,
		  bottom: Infinity,
		  offset: 15
		});
		
		$('.scrollspy').scrollSpy();
	});
    
    
    $("input[type='radio']").change(function () {
        redraw(false);
    });

    $("input[type='checkbox']").change(function () {
        redraw(false);
    })
	
	redraw(true);

    $('input[name=ap1]').change(function () {
        if ($(this).val() == 1) {
            $('#sec_ap2').show();
            $('#sec_ap4').hide();
            $('#sec_ap5').hide();
        }
        else {
            $('#sec_ap2').hide();
            $('#sec_ap3').hide();
            $('#sec_ap4').show();
        }
    });

    $('input[name=ap2]').change(function () {
        if ($(this).val() == 1) {
            $('#sec_ap3').show();
        }
        else {
            $('#sec_ap3').hide();
        }
    });

    $('input[name=ap4]').change(function () {
        if ($(this).val() == 1) {
            $('#sec_ap5').hide();
        }
        else {
            $('#sec_ap5').show();
        }
    });

    function redraw(bStart) {

        /* PHYSICAL ACTIVITY */
        var pa1 = $('input:radio[name=ap1]:checked').val();
        var pa2 = $('input:radio[name=ap2]:checked').val();
        var pa3 = $('input:radio[name=ap3]:checked').val();
        var pa4 = $('input:radio[name=ap4]:checked').val();
        var pa5 = $('input:radio[name=ap5_1]:checked').val();
        var pa6 = $('input:radio[name=ap5_2]:checked').val();

        var physicalActivity;

        if (pa1 == 1 && pa2 == 1 && pa3 == 1) {
            physicalActivity = 6;
        }
        else if (pa1 == 1 && pa2 == 1 && pa3 == 0) {
            physicalActivity = 5;
        }
        else if (pa1 == 1 && pa2 == 0) {
            physicalActivity = 4;
        }
        else if (pa1 == 0 && pa4 == 1) {
            physicalActivity = 3;
        }
        else if (pa1 == 0 && pa4 == 0 && pa5 == 0 && pa6 == 0) {
            physicalActivity = 1;
        }
        else if ((pa1 == 0 && pa4 == 0 && pa5 == 1 && pa6 == 0) || (pa1 == 0 && pa4 == 0 && pa5 == 0 && pa6 == 1) || (pa1 == 0 && pa4 == 0 && pa5 == 1 && pa6 == 1)) {
            physicalActivity = 2;
        }
        else {
            physicalActivity = 0;
        }

        var paPlot = physicalActivity / 6 * 100;

        /* MARCHE SANS AIDE */
        var walkHelp = $('input:radio[name=q1]:checked').val();
        var walkHelpPlot = (walkHelp / 5) * 100;

        /* VITESSE DE MARCHE */
        var walkSpeed = $('input:radio[name=q2]:checked').val();
        var walkSpeedPlot = (walkSpeed / 5) * 100;

        /* TEMPS DE MARCHE */
        var walkTime = $('input:radio[name=q3]:checked').val();
        var walkTimePlot = (walkTime / 7) * 100;

        /* CAPACITE A MONTER */
        var climb1 = parseInt($('input:radio[name=q4_1]:checked').val(), 10);
        var climb2 = parseInt($('input:radio[name=q4_2]:checked').val(), 10);
        var climb3 = parseInt($('input:radio[name=q4_3]:checked').val(), 10);
        var climb = climb1 + climb2 + climb3;
        var climbPlot = (climb / 27) * 100;
        if (climb1 == 0) {
            climbPlot = 0;
            $('#etage3').hide();
            $('#etage5').hide();
        } else {
            $('#etage3').show();
            $('#etage5').show();
        }
        /*
         if (climb1 > 0 && climb2 == 5){
         climbPlot = (climb / 27) * 100;
         $('#etage5').hide();
         } else if (climb1 > 0 && climb2 > 5) {
         $('#etage5').show();
         }*/

        /* ASSURANCE A MARCHER */
        var secure = parseInt($('input:radio[name=q8_1]:checked').val(), 10);
        secure = secure + parseInt($('input:radio[name=q8_2]:checked').val(), 10);
        secure = secure + parseInt($('input:radio[name=q8_3]:checked').val(), 10);
        var securePlot = (secure / 5) * 100;

        /* PEUR DU VIDE */
        var voids = $('input:radio[name=q5]:checked').val();
        var voidsPlot = 100 - (voids / 1 * 100);

        /* EQUILIBRE */
        var equilibre = $('input:radio[name=q9]:checked').val();
        var equilibrePlot = (equilibre / 2 * 100);

        /* DOULEURS */
        var pain = $('input:checkbox[name=q6]:checked').length;
        var painPlot = 100 - (pain / 5 * 100);
        if ($('#r6_6:checkbox:checked').length > 0) {
            painPlot = 100;
            $('input:checkbox[name=q6]').prop('checked', false);
            $('#r6_6').prop('checked', true);
        }
        if (pain === 0) {
            painPlot = 0;
        }

        /* MOBILITE ARTICULAIRE */
        var mobility = $('input:checkbox[name=q7]:checked').length;
        var mobilityPlot = 100 - (mobility / 3 * 100);
        if ($('#r7_4:checkbox:checked').length > 0) {
            mobilityPlot = 100;
            $('input:checkbox[name=q7]').prop('checked', false);
            $('#r7_4').prop('checked', true);
        }
        if (mobility === 0) {
            mobilityPlot = 0;
        }

        var rec1 = '';
        if (walkTime == 7) rec1 = "3h";
        else if (walkTime == 6) rec1 = "2h";
        else if (walkTime == 5) rec1 = "1h";
        else if (walkTime == 4) rec1 = "30 min";
        else if (walkTime == 3) rec1 = "15 min";
        else if (walkTime == 2) rec1 = "5 min";
        else if (walkTime < 2) rec1 = "Pas de marche";

        var rec2 = '';
        if (walkSpeed == 1) rec2 = "Proposer d'augmenter le temps indiqué de 30%";
        else if (walkSpeed == 2) rec2 = "Proposer d'augmenter le temps indiqué de 10%";
        else if (walkSpeed == 3) rec2 = "Proposer le temps indiqué";
        else if (walkSpeed == 4) rec2 = "Proposer de réduire le temps de 10%";
        else if (walkSpeed == 5) rec2 = "Proposer de réduire le temps de 20%";

        var rec3 = '';
        if (voids == 1) rec3 = "Pas de chemins exposés";
        else if (voids == 0) rec3 = "Chemins exposés possibles";

        var rec4 = '';
        if (climb3 > 12) rec4 = "Des dénivelés importants possibles";
        else if (climb3 > 10) rec4 = "Des dénivelés modérés possibles";
        else if (climb2 > 5) rec4 = "Seulement des dénivelés faibles à modérés possibles";
        else if (climb1 > 0) rec4 = "Seulement des dénivelés très faibles possibles";
        else if (climb1 == 0) rec4 = "pas des dénivelés possibles";

        var rec5 = '';
        if (secure < 5 && secure > 0) rec5 = "Proposer des randonnées accompagnées ou des chemins simples";
        else if (secure == 0) rec5 = "Proposer des chemins sans trop de difficulté (risque de chutes) et des randonnées accompagnées";
        else if (secure == 5) rec5 = "Pas de problèmes avec l'equilibre ou des risques de chutes; pas de propositions nécessaires";

        var rec6 = '';
        if (physicalActivity == 6) rec6 = "Bravo, continuez!";
        if (physicalActivity == 5) rec6 = "Proposer brochures sur l'activité physique ou conseils individuels dans centre de sports";
        if (physicalActivity == 4) rec6 = "Proposer brochures sur l'activité physique ou conseils individuels dans centre de sports";
        if (physicalActivity == 3) rec6 = "Proposer brochures pour surmonter les éventuelles barrières";
        if (physicalActivity == 2) rec6 = "Proposer brochures pour encourager de reprendre l'activité physique.";
        if (physicalActivity == 1) rec6 = "Proposer brochures pour encourager de reprendre l'activité physique et brochure sur les bénefices de l'activité physique.";

        if (rec1 != '')$('#rec1').text(rec1);
        if (rec2 != '')$('#rec2').text(rec2);
        if (rec3 != '')$('#rec3').text(rec3);
        if (rec4 != '')$('#rec4').text(rec4);
        if (rec5 != '') $('#rec5').text(rec5);
        if (physicalActivity > 0 ) {$('#rec6').text(rec6);}


        /*$("input:radio").attr("checked", false);
         $('#sec_ap2').hide();
         $('#sec_ap3').hide();
         $('#sec_ap4').hide();
         $('#sec_ap5').hide();*/


        if (bStart == true) {
            paPlot = 0;
            walkHelpPlot = 0;
            walkSpeedPlot = 0;
            walkTimePlot = 0;
            climbPlot = 0;
            securePlot = 0;
            voidsPlot = 0;
            equilibrePlot = 0;
            painPlot = 0;
            mobilityPlot = 0;

        }
        Highcharts.chart('radarID', {

            chart: {
                polar: true,
                type: 'line'
            },

            title: {
                text: 'Votre niveau fitness',
            },

            pane: {
                size: '60%'
            },

            xAxis: {
                categories: ['Activité physique', 'Marcher sans aides', 'Vitesse marche', 'Temps de marche',
                    'Capacité à monter', 'Assurance à marcher', 'Pas peur du vide', 'Equilibre', 'Sans douleurs', 'Mobilité articulaire'],
                tickmarkPlacement: 'on',
                lineWidth: 0
            },

            yAxis: {
                gridLineInterpolation: 'polygon',
                lineWidth: 0,
                min: 0,
                max: 100
            },

            tooltip: {
                shared: true,
                pointFormat: '<span style="color:{series.color}">{series.name}: <b>{point.y:,.0f}</b><br/>'
            },

            legend: {
                align: 'bottom',
                verticalAlign: 'top',
                y: 70,
                layout: 'vertical'
            },

            series: [{
                name: 'Votre niveau ',
                data: [paPlot, walkHelpPlot, walkSpeedPlot, walkTimePlot, climbPlot, securePlot, voidsPlot, equilibrePlot, painPlot, mobilityPlot],
                pointPlacement: 'on'
            }]
        });
		
		/* OBSTACLES */
		var racines = parseInt(document.getElementById('input-format0').value);
		var cailloux = parseInt(document.getElementById('input-format1').value);
		var cabosse = parseInt(document.getElementById('input-format2').value);
		/* TOPOLOGIE */
		var montees = parseInt(document.getElementById('input-format3').value);
		var descentes = parseInt(document.getElementById('input-format4').value);
		var plat = parseInt(document.getElementById('input-format5').value);
		/* PEUR DU VIDE */
		var ponts = parseInt(document.getElementById('input-format6').value);
		var cretes = parseInt(document.getElementById('input-format7').value);
		var courante = parseInt(document.getElementById('input-format8').value);
		/* DUREE */
		var uneH = parseInt(document.getElementById('input-format9').value);
		var deuxH = parseInt(document.getElementById('input-format10').value);
		var troisHplus = parseInt(document.getElementById('input-format11').value);
		
		var i = 0;	
		//Chart préférences
		Highcharts.chart('radarPref', {

			chart: {
				polar: true
			},
			title: {
				text: 'Préférences'
			},
			pane: {
				size: '60%',
				startAngle: 0,
				endAngle: 360
			},
			xAxis: {
			
				tickInterval: 30,
				min: 0,
				max: 360,
				labels: {
					formatter: function () {
									
						var lab = ['racines', 'cailloux', 'cabossé', 'montées', 'descentes', 'plat', 'ponts', 'crètes', 'main courante', '1h', '2h', '3h+'];
						i++;
						return lab[i-1];					
					}
				}
			},
			yAxis: {
				min: -10,
				max: 1
			},
			plotOptions: {
				series: {
					pointStart: 0,
					pointInterval: 30
				},
				column: {
					groupPadding: 0
				}
			},
			series: [{
				type: 'column',
				name: 'Column',
				data: [racines, cailloux, cabosse, montees, descentes, plat, ponts, cretes, courante, uneH, deuxH, troisHplus],
				pointPlacement: 'between'
			}]
		});	
		
    }
	
  function getSliderValue(name){
      var value = parseInt(document.getElementById(name).value);
      return (value/10)/2+0.5;
  }	
    
  function scores(){
     	/* OBSTACLES */
		var racines = getSliderValue('input-format0');
		var cailloux =getSliderValue('input-format1');
		var cabosse = getSliderValue('input-format2');
		/* TOPOLOGIE */
        var montees = getSliderValue('input-format3');
		var descentes = getSliderValue('input-format4');
		var plat = getSliderValue('input-format5');
		/* PEUR DU VIDE */
		var ponts = getSliderValue('input-format6');
		var cretes = getSliderValue('input-format7');
		var courante = getSliderValue('input-format8');
		/* DUREE */
		var uneH = getSliderValue('input-format9');
		var deuxH = getSliderValue('input-format10');
		var troisHplus = getSliderValue('input-format11');
      
      var score=[racines,cailloux,cabosse,montees,descentes,plat,
                 ponts,cretes,courante,uneH,deuxH,troisHplus];
      console.log(score);
      return score;
  }	

  function dotproduct(a,b) {
    var n = 0, lim = Math.min(a.length,b.length);
    for (var i = 0; i < lim; i++) n += a[i] * b[i];
    return n;
  }

  function norm2(a) {
    var sumsqr = 0; 
    for (var i = 0; i < a.length; i++) 
      sumsqr += a[i]*a[i]; 
    return Math.sqrt(sumsqr);
  }

  function similarity(a, b) {
    return dotproduct(a,b)/norm2(a)/norm2(b);
  }
    
  function getLevel(field) {
    if (field==null)
      return 0;
    else
      return _.max(field,"level").level / 10;
  }
    
  function getPathMetadata() {
    var names=[];
    $.getJSON( "parcours.json", function( data ) {    
      var paths=data.paths
      $.each( paths, function( k,path ) {
          names.push(path);
      });
    });
    return names;
  }    
  var metadata=getPathMetadata();    
              
  function computePathVectors() {
    var vectors = [];
    $.getJSON( "parcours.json", function( data ) {
        
      var paths=data.paths
      var i=0
      $.each( paths, function( k,path ) {
        var coso= _.groupBy(path.difficulty_points,'kind')
        var dur1h=(path.duration<1.5)? 1 : 0;
        var dur2h=(path.duration>=1.5 && path.duration<2.5)? 1 : 0;
        var dur3h=(path.duration>=2.5)? 1 : 0;
        var roots= getLevel(coso.roots);
        var stone= getLevel(coso.stone);
        var dirt = getLevel(coso.dirt);
        var ups  = getLevel(coso.up);
        var downs= getLevel(coso.down);
        var flat = 1 - getLevel(coso.vertical);
        var bridge= getLevel(coso.bridge);
        var narrow= getLevel(coso.narrow);
        var normal=0;
        var pathScore=[roots,stone,dirt,ups,downs,flat,
                      bridge,narrow,normal,dur1h,dur2h,dur3h];
        vectors.push(pathScore);
        var vertical= _.max(coso.vertical,"level")
       
      });
    }); 
    return vectors;
  }   
    
  var pathVectors=computePathVectors();    
    
  function computeScores() {
    var scoreUser=scores();
    var txt="";
    console.log(pathVectors);
    $("#pathTable").html('<thead><th></th><th>Parcours</th><th>distance</th><th>temps</th><th>lien</th><th>score</th></thead>');
    $.each( pathVectors, function( i,pathScore ) {
        console.log(pathScore);
        var distance=similarity(scoreUser,pathScore);
        $("#pathTable").append('<tr><td><img height="50" src="'+metadata[i].image+'" class="circle"></td><td>'+metadata[i].name+'</td><td>'+metadata[i].distance+'km</td><td>'+metadata[i].duration+'h</td><td><a href="'+metadata[i].link+'">Snukr</a></td><td>score '+distance.toFixed(2)+'</td> </tr>');
        //console.log("dist: "+distance)       
    });
    //$("#pathTable").html(txt);
    
  }	
</script>
</body>


